---
layout: post
title: kafka使用
description: 大数据专题
category: blog
---

##一 概述

   Kafka是由LinkedIn开发的一个开源的分布式消息发布-订阅系统，使用Scala编写，它以可水平扩展和高吞吐率而被广泛使用的。

###  1.1 使用消息系统的目的   
   <ol>
   <li>解耦：消息系统在处理过程中间插入了一个隐含的、基于数据的接口层，两边的处理过程都要实现这一接口。这允许你独立的扩展或修改两边的处理过程，只要  确保它们遵守同样的接口约束。
   </li>
   <li>冗余：有些情况下，处理数据的过程会失败。除非数据被持久化，否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。
   </li>
   <li>扩展性：消息队列解耦了你的处理过程，所以增大消息入队和处理的频率是很容易的，只要另外增加处理过程即可。不需要改变代码、不需要调节参数</li>
   <li>可恢复性：系统的一部分组件失效时，不会影响到整个系统。消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。</li>
   <li>顺序保证：在大多使用场景下，数据处理的顺序都很重要。大部分消息队列本来就是排序的，并且能保证数据会按照特定的顺序来处理。Kafka保证一个Partition内的消息的有序性。
   </li>
   <li>异步通信：消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。</li>
   </ol>
<ol>

### kafka优点   
   <ol>
   <li>时间复杂度低: 以时间复杂度为O(1)的方式提供消息持久化能力，即使对TB级以上数据也能保证常数时间复杂度的访问性能。
   </li>
   <li>高吞吐率: 即使在非常廉价的商用机器上也能做到单机支持每秒100K条以上消息的传输</li>
   <li>顺序性保障:支持Kafka Server间的消息分区，及分布式消费，同时保证每个Partition内的消息顺序传输。
    </li>
    <li>同时支持离线数据处理和实时数据处理</li>
    <li>支持在线水平扩展</li>
   </ol>
   
## 二 kafka应用及组成   
     <h1>应用场景</h1>
     <img src="/images/blog/kafka-applysence.png"> 
     <h1>组成</h1>
     <img src="/images/blog/kafka-consist.png"> 
     +   Broker
     Kafka集群包含一个或多个服务器，这种服务器被称为broker.
     +   Topic
             每条发布到Kafka集群的消息都有一个类别，这个类别被称为Topic。（物理上不同Topic的消息分开存储，逻辑上一个Topic的消息虽然   保存于一个或多个broker上,消费数据而不必关心数据存于何处）
     +   Partition
     是物理上的概念，每个Topic包含一个或多个Partition
     +   Producer
     负责发布消息到Kafka broker
     +   Consumer
     消息消费者，向Kafka broker读取消息的客户端
     +   Consumer Group
     每个Consumer属于一个特定的Consumer Group（可为每个Consumer指定group name，若不指定group name则属于默认的group）。
     
     

##三 关键性结论

以下结论对主成份分析非常重要<br>
<ol>
<li>结论1：标准化数据集州农工的总体变动性等于所有Z向量方差之和，等于每个成分方差之和，等于特征权值之和，等于变量的个数。即<br><img src="/images/blog/PCA7.png"></li>
<li>结论2：给定成分与给定变量间的偏相关性是特征向量与特征值的函数。具体来说<br><img src="/images/blog/PCA8.png">是相关系数矩阵p的<font color="gray">特征值-特征向量</font>对，并且偏相关系数包括了所有变量之间的影响。</li>
<li>结论3：Z中第i个主成份解释了变量的总体变异的百分比，等于第i个特征根与变量个数之间的比率<img src="/images/blog/PCA9.png"></li>
</ol>

##四 应用于实际数据  

   <img src="/images/blog/PCA10.png">
<ul>
    <li>>1.使用上图的均值和标准差对变量进行标准化，得到Z向量。</li>
    <li>>2.研究下图中变量矩阵图以检验变量间是否存在相关性。</li>
</ul>
可以看到 总房数、卧室数、人口数和家庭数之间表现出正相关性，西经和北纬表现出负相关性。再来观察变量的相关性矩阵：
![相关性矩阵](/images/blog/PCA4.jpg)

 矩阵图和相关矩阵式常用的两种方法，用来观察预测变量之间的相关性结构。  
如果完成一次住房价预测的多元回归分析，但不考虑数据集中的多重共线性将导致回归结果非常不稳定，预测值的微小变化将会导致回归系数的极大变化，而得不到任何结论。此时需要用主成分分析，其可以通过相关化结构，确定相关变量的基本组成部分
   <li>>3. 采用主成分分析对房屋数据集进行分析，该要素矩阵（下图）中每个栏目代表成分Yi=e'Z中的一项。栏目中元素为成分的权重，代表了变量与成分的偏相关。结论2 表明这些成分的权重等于Corr(Yi,Zi),成分涉及第i个特征向量和特征值
    </li>
   ![成分矩阵2](/images/blog/PCA5.jpg)
   <li>>4. 结论3表明，Z的总变异种第i个主成分所占的比例是ri/m(其中ri是特征值)，即第i个特征值与变量数的比例。由下图可以看出，第一特征值是 3.091,因为有8个预测变量，第一主成分解释 3.091/8=48.767%的变异。
   </li>  
![12](/images/blog/PCA6.jpg)
   
